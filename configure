#!/bin/sh

PREFIX="/usr/local"
FONTDIR="/share/fonts/ibm-fonts"
PCFDIR="pcf"

eval set -- "`getopt -o d --long prefix:,fontdir:,pcfdir: -n 'configure' -- "$@"`"

while true ; do
	case "$1" in
		--prefix)
			PREFIX="$2"; shift 2 ;;
		--fontdir)
			FONTDIR="$2"; shift 2 ;;
		--pcfdir)
			PCFDIR="$2"; shift 2 ;;
		--)
			shift; break ;;
		*)
			printf "usage: $0 [--prefix=<PATH>] [--fontdir=<PATH>] [--pcfdir=<PATH>]"
			break ;;
	esac
done

ALL="all: \$(pcfdir)"
INSTALL="install: all
	install -dm755 \$(DESTDIR)\$(fontdir)"
UNINSTALL="uninstall:"

for BDF in bdf/*.bdf; do
	PCF="`basename -s .bdf $BDF`.pcf.gz"

	ALL="$ALL \$(pcfdir)/$PCF"

	INSTALL="$INSTALL
	install -Dm644 \$(pcfdir)/$PCF \$(DESTDIR)\$(fontdir)"

	UNINSTALL="$UNINSTALL
	rm -f \$(DESTDIR)\$(fontdir)/$PCF"
done

cat << EOF > Makefile
.PHONY: all clean install uninstall \$(pcfdir)

prefix = $PREFIX
fontdir = \$(prefix)$FONTDIR
pcfdir = $PCFDIR

$ALL

clean:
	rm -f \$(pcfdir)/*.pcf.gz 

$INSTALL

$UNINSTALL

\$(pcfdir):
	mkdir -p \$(pcfdir)	

\$(pcfdir)/%.pcf.gz: bdf/%.bdf
	bdftopcf \$< | gzip > \$@

EOF
